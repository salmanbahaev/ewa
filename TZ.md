# ТЗ: AI-ассистент EWA (Telegram Bot)

## Цель проекта

Telegram-бот консультант по продукции компании EWA с AI-функционалом для ответов на общие и специфичные вопросы о здоровье и каталоге товаров.

## Основной функционал

### Типы запросов

1. **Общие вопросы** - ответы из знаний GPT-5 mini (витамины, здоровье, нутрициология)
2. **Вопросы о продуктах EWA** - поиск в JSON каталоге по тегам/описанию
3. **Комбинированные** - теория + рекомендация продуктов

### Технологии

- Python 3.10+
- aiogram 3.x
- OpenAI GPT-5 mini API (Function Calling)
- SQLite (история диалогов)
- JSON база данных

---

## Этапы реализации

### ✅ Этап 0: Подготовка

- [x] Создание `.cursorrules`
- [x] Сбор данных с сайта в JSON
- [x] Анализ структуры данных

### ✅ Этап 1: Структура проекта

- [x] Создание файловой структуры
- [x] `requirements.txt` с зависимостями
- [x] `.env.example` для конфигурации
- [x] `config.py` для настроек

### ✅ Этап 2: База данных

- [x] `data/database.py` - SQLite для истории
- [x] Таблица `users` (user_id, username, created_at)
- [x] Таблица `messages` (id, user_id, role, content, timestamp)
- [x] Функции: сохранение, получение истории, очистка

### ✅ Этап 3: AI-логика

- [x] `ai/prompts.py` - system промпты для ассистента
- [x] `ai/product_search.py` - поиск продуктов по тегам/описанию
- [x] `ai/assistant.py` - основная логика (Function Calling)
- [x] Функции для GPT: `search_products()`, `get_company_info()`
- [x] Обработка ответов GPT

### ✅ Этап 4: Telegram Bot

- [x] `bot/keyboards/main.py` - inline кнопки (Очистить историю)
- [x] `bot/handlers/start.py` - команда /start
- [x] `bot/handlers/messages.py` - обработка текстовых сообщений
- [x] `bot/handlers/callbacks.py` - обработка кнопок
- [x] `bot/middlewares/logging.py` - логирование в .log файлы

### ✅ Этап 5: Интеграция

- [x] `main.py` - точка входа, инициализация бота
- [x] Связка: пользователь → история → GPT → поиск → ответ
- [x] Тестирование локально

### ✅ Этап 6: Тестирование

- [x] Тест общих вопросов (витамины, здоровье)
- [x] Тест поиска продуктов (по тегам)
- [x] Тест истории диалогов
- [x] Тест кнопки очистки истории
- [x] Проверка логов

### ✅ Этап 7: Деплой на VPS

- [x] Установка Python на Ubuntu VPS
- [x] Установка зависимостей
- [x] Создание systemd service файла
- [x] Запуск и проверка работы
- [x] Настройка автозапуска

**Инструкция:** См. файл `DEPLOY.md`

---

## Структура файлов

```
ewa/
├── bot/
│   ├── __init__.py
│   ├── handlers/
│   │   ├── __init__.py
│   │   ├── start.py
│   │   ├── messages.py
│   │   └── callbacks.py
│   ├── keyboards/
│   │   ├── __init__.py
│   │   └── main.py
│   └── middlewares/
│       ├── __init__.py
│       └── logging.py
├── ai/
│   ├── __init__.py
│   ├── assistant.py
│   ├── product_search.py
│   └── prompts.py
├── data/
│   ├── __init__.py
│   ├── database.py
│   └── catalog.json
├── logs/
│   └── (автоматически создаются .log файлы)
├── .env
├── .env.example
├── .cursorrules
├── config.py
├── main.py
├── requirements.txt
└── TZ.md
```

---

## Данные

### catalog.json (продукты)

```json
{
  "id": "B001",
  "name": "BRAINSTORM",
  "category": "БИОХАКИНГ",
  "price_rub": 2350,
  "quantity_volume": "20 стиков",
  "description": "Для улучшения умственной деятельности...",
  "tags": ["мозг", "память", "концентрация"]
}
```

### company_info.json (информация о компании)

- О компании
- Бизнес/сотрудничество
- События
- География (адреса)

---

## API & Ключи

**OpenAI API:**

- Ключ: `ваш_openai_api_ключ`
- Модель: `gpt-4o-mini`

**Telegram Bot:**

- Токен: (получить из BotFather)

---

## Приоритеты

1. ✅ Работоспособность
2. ✅ Точность ответов (без галлюцинаций)
3. ✅ Простота UX (понятные кнопки, быстрые ответы)
4. ✅ Логирование для отладки

---

## Критерии готовности

- Бот отвечает на общие вопросы о здоровье
- Бот находит и рекомендует продукты из каталога
- История диалога сохраняется между сессиями
- Кнопка "Очистить историю" работает
- Логи пишутся в файлы
- Деплой на VPS, работает стабильно

---

## Сроки

Тестовый проект на 1 неделю работы.
